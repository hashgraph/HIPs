---
hip: 376
title:  Support Approve/Allowance/transferFrom standard calls from ERC20 and ERC721
author: Stoyan Panayotov <stoyan.panayotov@limechain.tech>
type: Standards Track
category: Service
needs-council-approval: Yes
status: Review
created: 2022-03-02
discussions-to: https://github.com/hashgraph/hedera-improvement-proposal/discussions/378
updated: 
requires: 206, 218, 336
---

## Abstract

Describe the added support for industry standart `ERC20` and `ERC721` functions related to token approvals and allowances in Hedera's Smart Contract Service.

## Motivation

The goal is to expose [HIP-336](https://hips.hedera.com/hip/hip-336): Approval and Allowance API for Tokens functionality in industry standard `ERC-20` and `ERC-721` calls for smart contract developers on Hedera.

## User stories

### Fungible token related stories

As a hedera smart contract services user, I want to enable another user the ability to spend `x` fungible tokens from my account so that they can trade on my behalf without requiring that I expose my private key to them.

As a hedera smart contract services user, I want to query tokens for the current token allowances that have been granted to a user (spender) for a specific owner account.

As a hedera smart contract services user, I want to modify or remove an allowance I have granted to another user so that I can manage that user's ability to spend my tokens over time.

As a hedera smart contract services user that has been granted an allowance, I want to be able to  transfer tokens owned by the owner account as if they were my tokens so that I can issue transfers on their behalf without them having to expose their private key.

### Non-fungible token related stories

As a hedera smart contract services user, I want to enable another user the ability to spend specific non-fungible tokens from my account so that they can trade on my behalf without requiring that I expose my private key to them.

As a hedera smart contract services user, I want to enable or disable another user the ability to spend all instances of a particular non-fungible token that I currently or may in the future hold in my account so that they can trade on my behalf without requiring that I expose my private key to them.

As a hedera smart contract services user, I want to modify or remove an allowance I have granted to another user so that I can manage that user's ability to spend my tokens over time.

// TODO: can we allow multiple accounts for the same NFT in Hedera? What should happen then when we call getApproved?
As a hedera smart contract services user, I want t

As a hedera smart contract services user that has been granted an allowance, I want to be able to  transfer tokens owned by the owner account as if they were my tokens so that I can issue transfers on their behalf without them having to expose their private key.

## Specification

### EVM Precompile

Extend the functionality from [HIP-218](https://hips.hedera.com/hip/hip-218): Smart Contract interactions with Hedera Token Accounts with support for `approve`, `allowance` and `transferFrom` functions.

#### Supported ERC-20 operations

Tokens of type `FUNGIBLE_COMMON` will support standard `ERC-20` calls.

The following `ERC-20` operations will be supported. Standard `ERC-20 Events` will be emitted as appropriate.

- `function allowance(address owner, address spender) external view returns (uint256);`
- `function approve(address spender, uint256 amount) external returns (bool);`
- `function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);`

#### Supported ERC-721 operations

Tokens of type `NON_FUNGIBLE_UNIQUE` will support standard `ERC-721` calls.

The following `ERC-721` operations will be supported. Standard `ERC-721 Events` will be emitted as appropriate.

  - `function approve(address _approved, uint256 _tokenId) external payable`
  - `function setApprovalForAll(address _operator, bool _approved) external`
  - `function getApproved(uint256 _tokenId) external view returns (address)`
  - `function isApprovedForAll(address _owner, address _operator) external view returns (bool)`
  - `function transferFrom(address _from, address _to, uint256 _tokenId) external payable`

#### Gas Schedule

For function calls that cause HTS token transfers the appropriate gas charges will be applied. Calls that emit events will be charged the event fees too.

We take the canonical max calls per second, and divide that into the 15MM gas per second, and add a 20% premium. The trick is figuring out which max TPX measure to use.

| Function         | Base Cost |  Incremental Cost |
| -----------------| --------: | ----------------: |
| Queries          |    xx Gas |             0 Gas |
| Approves         |    xx Gas |             0 Gas |
| Transfer         |    xx Gas |             0 Gas |

## Backwards Compatibility

The existing functions in the HTS precompile will remain in place, all prior usages of the precompile will function as they did before.

## Security Implications

The same implications relating to contract keys and delegate calls outlined in HIP-206 also apply to the direct support of ERC-20 and ERC-721 contracts.

## How to Teach This

Tutorials and SDK examples should be written showing how solidity can access the token accounts directly as ERC-20 and ERC-721 contracts.

HSCS documentation should be updated to explicitly enumerate the supported and non-supported contract functions.

## Reference Implementation

// TODO

## Rejected Ideas


## Open Issues

None at this time.

## References

- [ERC-20: Token Standard](https://eips.ethereum.org/EIPS/eip-20)
- [ERC-721: Non-Fungible Token Standard](https://eips.ethereum.org/EIPS/eip-721)
- [HIP-218: Smart Contract interactions with Hedera Token Accounts](https://hips.hedera.com/hip/hip-218)
- [HIP-336: Approval and Allowance API for Tokens](https://hips.hedera.com/hip/hip-336)

## Copyright/license

This document is licensed under the Apache License, Version 2.0 -- see [LICENSE](../LICENSE) or (https://www.apache.org/licenses/LICENSE-2.0)
