---
hip: 690
title: Identify Community Nodes in Address Book and Related API
author: Kim Rader <kim.rader@swirldslabs.com>
working-group: Simi Hunjan <simi@hedera.com>, Ali Katamjani <ali@swirldslabs.com>
type: Standards Track
category: Core
needs-council-approval: Yes
status: Last Call
last-call-date-time: 2023-03-27T07:00:00Z
created: 2023-03-01
discussions-to: https://github.com/hashgraph/hedera-improvement-proposal/discussions/691
updated: 2023-03-15
---

## Abstract
Add a property to the address book to indicate whether a node belongs to a council member or a community member. Update related protobuf message and mirror node response objects.

## Motivation
As we begin onboarding node operators outside of council members as part of the community node project, there is a desire to be able to query using node Id whether a node is a community node or a council node.

This information is important to users when choosing a node to stake to. This information can be made available in Hashscan and then partners can expose this data when offering staking to customers. In order to support this, Mirror Node Explorer needs to reliably know which node is council or community, so they can expose this data. Although this can be done manually, it will be extremely hard to maintain as we grow community nodes, therefore we will need to define a systematic path to query if a node is community node or not.

Currently, council members have their accounts hardcoded. They need a way to rotate their account numbers. There is separate work going on to make that happen. Adding a community node flag is a required prerequisite.

Application developers need a way to know which nodes are council nodes vs community nodes so that they can identify these two types of nodes in applications.

## Rationale

When Hedera begins allowing non-council members to run nodes, there will be more nodes coming online. This proposal seeks to provide a way to identify which nodes are council nodes and which are non-council (community) nodes.

Currently, each node has an address book configuration file which ties IP addresses to nodes and accounts to nodes. We propose a small addition to the address book to add a new property to indicate whether a given node is a council node or a community node. The information can then be read by outside applications via a small change to the mirror node API.

## User stories

- As an application developer, I need a reliable way to know which nodes are council nodes vs. community nodes so that I can appropriately identify them in my application.
- As a developer for an application which supports staking, I want to be able to show my customers whether a node they are choosing to stake to is a council or a community node.
    - Users might trust council operated nodes over community hosted nodes
    - Today, we only have council nodes in the nodes page in the explorer
    - After community nodes are added there is not an immediate way to tell the node operator type (community vs. council)

## Specification

The proposal is to add a new enumerated value `NodeOwnershipType` as a new property of the `nodeAddress` object in the address book file. 
Possible values are `COUNCIL`=0, `PERMISSIONED`=1 and `NON_PERMISSIONED`=2. 
`COUNCIL` is the default value and indicates that the node belongs to a council member.
`PERMISSIONED` and `NON_PERMISSIONED` indicate that the node belongs to a community member.
If omitted the property defaults to 0 (`COUNCIL`), ensuring backwards compatibility.

The [nodeAddress protobuf definition](https://github.com/hashgraph/hedera-protobufs/blob/main/services/basic_types.proto#L1330) 
requires a new property `nodeOwnershipType` to transmit this information.
```
/**
* The data about a node, including its service endpoints and the Hedera account to be paid for
* services provided by the node (that is, queries answered and transactions submitted.)
*
* If the <tt>serviceEndpoint</tt> list is not set, or empty, then the endpoint given by the
* (deprecated) <tt>ipAddress</tt> and <tt>portno</tt> fields should be used.
*
* All fields are populated in the 0.0.102 address book file while only fields that start with # are
* populated in the 0.0.101 address book file.
*/
  message NodeAddress {
  /**
  * The IP address of the Node with separator & octets encoded in UTF-8.  Usage is deprecated,
  * ServiceEndpoint is preferred to retrieve a node's list of IP addresses and ports
  */
    bytes ipAddress = 1 [deprecated=true];

  /**
  * The port number of the grpc server for the node.  Usage is deprecated, ServiceEndpoint is
  * preferred to retrieve a node's list of IP addresses and ports
  */
    int32 portno = 2 [deprecated=true];

  /**
  * Usage is deprecated, nodeAccountId is preferred to retrieve a node's account ID
  */
    bytes memo = 3 [deprecated=true];

  /**
  * The node's X509 RSA public key used to sign stream files (e.g., record stream
  * files). Precisely, this field is a string of hexadecimal characters which,
  * translated to binary, are the public key's DER encoding.  
  */
    string RSA_PubKey = 4;

  /**
  * # A non-sequential identifier for the node
  */
  int64 nodeId = 5;

  /**
  * # The account to be paid for queries and transactions sent to this node
  */
  AccountID nodeAccountId = 6;

  /**
  * # Hash of the node's TLS certificate. Precisely, this field is a string of
  * hexadecimal characters which, translated to binary, are the SHA-384 hash of
  * the UTF-8 NFKD encoding of the node's TLS cert in PEM format. Its value can be
  * used to verify the node's certificate it presents during TLS negotiations.
  */
    bytes nodeCertHash = 7;

  /**
  * # A node's service IP addresses and ports
  */
  repeated ServiceEndpoint serviceEndpoint = 8;

  /**
  * A description of the node, with UTF-8 encoding up to 100 bytes
  */
    string description = 9;

  /**
  * [Deprecated] The amount of tinybars staked to the node
  */
    int64 stake = 10 [deprecated = true];
  
  /**
    * The ownership type of the node. Whether the node belongs to a council member or a community member.
    * If not present, defaults to 0 (COUNCIL).
    */
    NodeOwnershipType nodeOwnerShipType = 0;
  }
  
  /**
  * Ownership type of the node. Whether the node is owned by a council member or a community member.
  */
  enum NodeOwnershipType {
      COUNCIL = 0;
      PERMISSIONED = 1;
      NON_PERMISSIONED = 2;
  }
```

The mirrornode REST API will also expose this datum. The /network/nodes endpoint currently returns an array of `nodes` objects. 
A new property `nodeOwnershipType` will be added to the `nodes` response object.

## Backwards Compatibility

If not present in the address book configuration, the `nodeOwnershipType` property defaults to COUNCIL = 0. This ensures full backwards compatibility.

## Security Implications

The address book is stored in state in system files `0.0.101` and `0.0.102`.
If a malicious node operator changes its own copies of the file, then this will result in the malicious node getting an ISS.
The remainder of the network will ignore this invalid file.

## How to Teach This

- Hedera protobuf documentation
- Hedera Mirror Node documentation - description and code examples of queries in the REST API documentation

## Rejected Ideas

If community node operator node account IDs are not part of the Hedera system accounts (entities under `0.0.1000`) then the application 
could say all council nodes are node account IDs under `0.0.1000` and all node account IDs greater than 1000 are community nodes.
This idea was discussed but rejected because there have been requests by council members to move to new account numbers 
above 0.0.1000 and not one of the accounts in the privileged range, making this idea not a viable long term solution.

Also discussed was the idea of adding a flag instead of an enumerated value. This was rejected because an enumerated value
adds more flexibility in the future if we want to add more ownership types.

## Open Issues

None.

## References

- [https://github.com/hashgraph/hedera-protobufs/blob/main/services/basic_types.proto#L1330](https://github.com/hashgraph/hedera-protobufs/blob/main/services/basic_types.proto#L1330)
- [https://mainnet-public.mirrornode.hedera.com/api/v1/docs/#/network/getNetworkNodes](https://mainnet-public.mirrornode.hedera.com/api/v1/docs/#/network/getNetworkNodes)

## Copyright/license

This document is licensed under the Apache License, Version 2.0 -- see [LICENSE](*../LICENSE*) or (https://www.apache.org/licenses/LICENSE-2.0)
